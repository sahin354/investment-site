<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>System Control Panel</title>
    <link rel="stylesheet" href="style.css" />
    <style>
        /* --- Base Styles --- */
        .control-container{padding:20px;max-width:1200px;margin:0 auto}.control-header{background:linear-gradient(135deg,#1a237e,#283593);color:#fff;padding:20px;border-radius:10px;margin-bottom:20px;display:flex;justify-content:space-between;align-items:center}.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px;margin-bottom:30px}.stat-card{background:#fff;padding:25px;border-radius:10px;box-shadow:0 4px 15px rgba(0,0,0,.1);text-align:center;border-left:4px solid #1a237e}.stat-number{font-size:2.5em;font-weight:700;color:var(--primary-color);margin:10px 0}.stat-label{color:var(--text-light);font-size:.9em}.control-tabs{display:flex;background:#fff;border-radius:10px;overflow:hidden;margin-bottom:20px;box-shadow:0 2px 10px rgba(0,0,0,.1)}.control-tab{flex:1;padding:15px;border:none;background:0 0;cursor:pointer;font-size:1em;transition:all .3s}.control-tab.active{background:#1a237e;color:#fff}.tab-content{display:none;background:#fff;padding:20px;border-radius:10px;box-shadow:0 2px 10px rgba(0,0,0,.1)}.tab-content.active{display:block}.user-table{width:100%;border-collapse:collapse;margin-top:15px}.user-table th,.user-table td{padding:12px;text-align:left;border-bottom:1px solid #eee}.user-table th{background:#f8f9fa;font-weight:600}.action-btn{padding:6px 12px;border:none;border-radius:5px;cursor:pointer;margin:2px;font-size:.8em;color:#fff}.edit-btn{background:#3498db}.delete-btn{background:#e74c3c}.block-btn{background:#f39c12}.form-group{margin-bottom:15px}.form-group label{display:block;margin-bottom:5px;font-weight:500}.form-group input,.form-group select,.form-group textarea{width:100%;padding:10px;border:1px solid #ddd;border-radius:5px;box-sizing:border-box;font-size:1em}.control-actions{display:flex;gap:10px;margin-top:15px}.logout-control{background:#e74c3c;color:#fff;border:none;padding:10px 20px;border-radius:5px;cursor:pointer}.system-alert{background:#fff3cd;border:1px solid #ffeaa7;color:#856404;padding:10px;border-radius:5px;margin-bottom:15px;font-size:.9em}
        
        /* --- Plan Management Styles --- */
        .plan-card { border: 1px solid #eee; border-left: 4px solid #3498db; border-radius: 8px; padding: 15px; margin-bottom: 15px; background: #fdfdfd; }
        .plan-card.vip { border-left-color: #9b59b6; }
        .plan-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .plan-title { font-size: 1.2em; font-weight: 600; }
        .plan-title .vip-badge { background: #9b59b6; color: white; font-size: 0.7em; padding: 3px 8px; border-radius: 10px; margin-left: 8px; vertical-align: middle; }
        .plan-details { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; font-size: 0.9em; }
        .plan-details div { background: #f4f4f4; padding: 8px; border-radius: 5px; }
        .plan-details strong { color: #333; display: block; font-size: 0.8em; margin-bottom: 2px; }
        .plan-actions { margin-top: 15px; text-align: right; }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.5); }
        .modal-content { background-color: #fefefe; margin: 10% auto; padding: 25px; border: 1px solid #888; width: 80%; max-width: 600px; border-radius: 10px; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; padding-bottom: 10px; margin-bottom: 20px; }
        .modal-header h2 { margin: 0; }
        .close-btn { color: #aaa; font-size: 28px; font-weight: bold; cursor: pointer; }
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        
        /* --- NEW: Payment Sub-Tabs --- */
        .payment-sub-tabs { display: flex; border-bottom: 2px solid #eee; margin-bottom: 20px; }
        .payment-sub-tab { padding: 10px 20px; border: none; background: none; cursor: pointer; font-size: 1.1em; color: #777; }
        .payment-sub-tab.active { color: var(--primary-color); font-weight: bold; border-bottom: 2px solid var(--primary-color); }
        .payment-tab-content { display: none; }
        .payment-tab-content.active { display: block; }
        
    </style>
</head>
<body>
    <div class="control-container">
        <div class="control-header">
            <div><h1>üîí System Control Panel</h1><p>Secure System Management Interface</p></div>
            <button id="logoutButton" class="logout-control">Secure Logout</button>
        </div>
        <div class="system-alert">‚ö†Ô∏è <strong>Security Notice:</strong> This interface is monitored. All activities are logged.</div>
        <div class="stats-grid">
            <div class="stat-card"><div class="stat-label">System Users</div><div class="stat-number" id="totalUsers">0</div></div>
            <div class="stat-card"><div class="stat-label">Total Balance</div><div class="stat-number" id="totalBalance">‚Çπ0</div></div>
            <div class="stat-card"><div class="stat-label">Active Sessions</div><div class="stat-number" id="activeUsers">0</div></div>
            <div class="stat-card"><div class="stat-label">System Status</div><div class="stat-number" style="color: #27ae60;">‚úì Online</div></div>
        </div>

        <div class="control-tabs">
            <button class="control-tab active" data-tab="users">User Management</button>
            <button class="control-tab" data-tab="balance">Financial Control</button>
            <button class="control-tab" data-tab="payments">Payment Requests</button>
            <button class="control-tab" data-tab="plans">Plan Settings</button>
            <button class="control-tab" data-tab="settings">System Config</button>
        </div>

        <div id="usersTab" class="tab-content active">
            <h3>üë• User Account Management</h3>
            <div class="form-group"><input type="text" id="searchUser" placeholder="Search users by email or ID..."></div>
            <div style="overflow-x: auto;">
                <table class="user-table">
                    <thead>
                        <tr>
                            <th>User ID</th>
                            <th>Email</th>
                            <th>Balance</th>
                            <th>Join Date</th>
                            <th>Status</th>
                            <th>Bank Name</th>
                            <th>Bank Account</th>
                            <th>IFSC</th>
                            <th>UPI</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="usersTableBody"></tbody>
                </table>
            </div>
        </div>

        <div id="balanceTab" class="tab-content">
            <h3>üí∞ Financial Management</h3>
            <div class="form-group"><label for="userSelect">Select User Account</label><select id="userSelect"><option value="">Select user account...</option></select></div>
            <div class="form-group"><label for="balanceAction">Transaction Type</label><select id="balanceAction"><option value="add">Add Funds</option><option value="subtract">Deduct Funds</option><option value="set">Set Balance</option></select></div>
            <div class="form-group"><label for="balanceAmount">Amount (‚Çπ)</label><input type="number" id="balanceAmount" placeholder="Enter amount"></div>
            <div class="form-group"><label for="balanceReason">Transaction Note</label><textarea id="balanceReason" placeholder="Reason for this transaction (e.g., Bonus, Refund)"></textarea></div>
            <button id="updateBalanceButton" class="submit-btn">Execute Transaction</button>
        </div>

        <div id="paymentsTab" class="tab-content">
            <h3>‚åõ Payment Requests</h3>
            
            <div class="payment-sub-tabs">
                <button class="payment-sub-tab active" data-tab="deposits">Deposit Requests</button>
                <button class="payment-sub-tab" data-tab="withdrawals">Withdrawal Requests</button>
            </div>
            
            <div id="depositsContent" class="payment-tab-content active">
                <h4>Pending Deposits</h4>
                <div style="overflow-x: auto;">
                    <table class="user-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>User Email</th>
                                <th>Amount (‚Çπ)</th>
                                <th>UTR / Ref No.</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="paymentRequestsTableBody">
                            </tbody>
                    </table>
                </div>
            </div>
            
            <div id="withdrawalsContent" class="payment-tab-content">
                <h4>Pending Withdrawals</h4>
                <div style="overflow-x: auto;">
                    <table class="user-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>User Email</th>
                                <th>Request (‚Çπ)</th>
                                <th>TDS (18%)</th>
                                <th>Final Payout (‚Çπ)</th>
                                <th>Bank Name</th>
                                <th>Account No.</th>
                                <th>IFSC</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="withdrawalRequestsTableBody">
                            </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div id="plansTab" class="tab-content">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <h3>üìä Investment Plan Settings</h3>
                <button id="createNewPlanBtn" class="submit-btn">‚ûï Create New Plan</button>
            </div>
            <hr style="margin: 20px 0;">
            <div id="plansContainer"></div>
        </div>

        <div id="settingsTab" class="tab-content">
            <h3>‚öôÔ∏è System Configuration</h3>
            
            <div class="form-group">
              <label for="paymentUpiId">Payment UPI ID (e.g., your-upi@okhdfc)</label>
              <input type="text" id="paymentUpiId" placeholder="Enter UPI ID to show to users">
            </div>
            <div class="form-group">
              <label for="paymentAccountInfo">Bank Account Info (Optional)</label>
              <textarea id="paymentAccountInfo" placeholder="e.g., A/C No: 12345, IFSC: 6789"></textarea>
            </div>
            <hr style="margin: 20px 0;">
            
            <div class="form-group"><label for="commission1">Referral Commission - Level 1 (%)</label><input type="number" id="commission1" value="21" min="0" max="100"></div>
            <div class="form-group"><label for="commission2">Referral Commission - Level 2 (%)</label><input type="number" id="commission2" value="3" min="0" max="100"></div>
            <div class="form-group"><label for="commission3">Referral Commission - Level 3 (%)</label><input type="number" id="commission3" value="1" min="0" max="100"></div>
            <div class="form-group"><label for="minWithdrawal">Minimum Withdrawal Limit</label><input type="number" id="minWithdrawal" value="100"></div>
            <div class="form-group"><label for="maxWithdrawal">Maximum Withdrawal Limit</label><input type="number" id="maxWithdrawal" value="50000"></div>
            <button id="saveSettingsButton" class="submit-btn">üíæ Save Configuration</button>
        </div>
    </div>

    <div id="planModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="planModalTitle">Create New Plan</h2>
                <span class="close-btn" id="closePlanModal">&times;</span>
            </div>
            <form id="planForm">
                <input type="hidden" id="planId">
                <div class="form-group"><label for="planName">Plan Name</label><input type="text" id="planName" placeholder="e.g., Basic Daily Plan" required></div>
                <div class="form-grid">
                    <div class="form-group"><label for="planMinAmount">Investment Price (‚Çπ)</label><input type="number" id="planMinAmount" placeholder="500" required></div>
                    <div class="form-group"><label for="planDuration">Plan Duration (Days)</label><input type="number" id="planDuration" placeholder="30" required></div>
                    <div class="form-group"><label for="planDailyReturn">Daily Return (%)</label><input type="number" id="planDailyReturn" step="0.1" placeholder="5.5" required></div>
                    <div class="form-group"><label for="planTotalReturn">Total Return (%)</label><input type="number" id="planTotalReturn" placeholder="165" readonly></div>
                </div>
                <div class="form-group"><label><input type="checkbox" id="planIsVIP"> Is this a VIP Plan?</label></div>
                <div class="control-actions">
                    <button type="submit" class="submit-btn">üíæ Save Plan</button>
                    <button type="button" id="deletePlanBtn" class="delete-btn" style="display: none;">üóëÔ∏è Delete Plan</button>
                </div>
            </form>
        </div>
    </div>
    
    <div id="userDetailsModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2 id="userDetailsTitle">User Details</h2>
                <span class="close-btn" id="closeUserDetailsModal">&times;</span>
            </div>
            
            <div id="userDetailsContent">
                </div>
            
            <hr>
            
            <h3>Transaction History</h3>
            <div id="userTransactionList" style="max-height: 400px; overflow-y: auto;">
                </div>
        </div>
    </div>


    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-functions.js"></script>
    <script src="firebaseConfig.js"></script>
    <script src="script-control.js"></script>
    
    <script src="script-payment-approval.js"></script>
</body>
</html>
