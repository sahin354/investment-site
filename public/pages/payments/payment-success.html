<!DOCTYPE html>
<html>
<head>
  <title>Payment Status</title>
</head>
<body>
  <h3 id="msg">⏳ Verifying payment...</h3>

<script>
(async () => {
  const orderId = new URLSearchParams(location.search).get("order_id");
  const userId = localStorage.getItem("uid");

  if (!orderId || !userId) {
    document.getElementById("msg").innerText = "Invalid payment session";
    return;
  }

  try {
    const res = await fetch("/api/pay0-check-status", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ order_id: orderId, user_id: userId })
    });

    const data = await res.json();

    if (data.status === "SUCCESS") {
      document.body.innerHTML = `
        <h2>✅ Payment Successful</h2>
        <button onclick="location.href='/mine.html'">Go Back</button>
      `;
    } else if (data.status === "FAILED") {
      document.body.innerHTML = `
        <h2>❌ Payment Failed</h2>
        <button onclick="location.href='/recharge.html'">Retry</button>
      `;
    } else {
      document.body.innerHTML = `<h2>⏳ Payment Pending</h2>`;
    }
  } catch (e) {
    document.getElementById("msg").innerText = "Verification failed";
  }
})();
</script>
</body>
</html>
