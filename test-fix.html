<!-- test-fix.html -->
<!DOCTYPE html>
<html>
<head>
    <title>Test Registration & Recharge</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <h2>Test Fix</h2>
    
    <div>
        <h3>1. Check Profiles Table</h3>
        <button onclick="checkProfiles()">Check Profiles</button>
        <div id="profileResult"></div>
    </div>
    
    <div>
        <h3>2. Test Payment Requests</h3>
        <button onclick="testPaymentRequest()">Test Payment Request</button>
        <div id="paymentResult"></div>
    </div>
    
    <script>
        const supabaseUrl = 'YOUR_SUPABASE_URL';
        const supabaseAnonKey = 'YOUR_SUPABASE_ANON_KEY';
        const supabase = supabase.createClient(supabaseUrl, supabaseAnonKey);
        
        async function checkProfiles() {
            document.getElementById('profileResult').innerHTML = 'Checking...';
            
            try {
                // Check profiles table structure
                const { data, error } = await supabase
                    .from('profiles')
                    .select('*')
                    .limit(5);
                
                if (error) {
                    document.getElementById('profileResult').innerHTML = 
                        'Error: ' + error.message;
                    return;
                }
                
                document.getElementById('profileResult').innerHTML = 
                    'Profiles found: ' + data.length + '<br>' +
                    JSON.stringify(data, null, 2);
                    
            } catch (error) {
                document.getElementById('profileResult').innerHTML = 
                    'Error: ' + error.message;
            }
        }
        
        async function testPaymentRequest() {
            document.getElementById('paymentResult').innerHTML = 'Testing...';
            
            try {
                const { data: { user } } = await supabase.auth.getUser();
                
                if (!user) {
                    document.getElementById('paymentResult').innerHTML = 
                        'Please login first';
                    return;
                }
                
                const orderId = 'TEST_' + Date.now();
                const { error } = await supabase
                    .from('payment_requests')
                    .insert({
                        user_id: user.id,
                        user_email: user.email,
                        order_id: orderId,
                        amount: 100,
                        status: 'TEST',
                        payment_method: 'Test'
                    });
                
                if (error) {
                    document.getElementById('paymentResult').innerHTML = 
                        'Payment Request Error: ' + error.message;
                    return;
                }
                
                document.getElementById('paymentResult').innerHTML = 
                    'âœ… Payment request created successfully!<br>' +
                    'Order ID: ' + orderId;
                    
            } catch (error) {
                document.getElementById('paymentResult').innerHTML = 
                    'Error: ' + error.message;
            }
        }
    </script>
</body>
</html>
